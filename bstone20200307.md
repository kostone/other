# 組込みシステム

## マイコンとメモリ
マイコンはその用途ゆえにパソコンとは異なる観点でメモリが採用される。

### ROM(Read Only Memory)
マイコンの主記憶にはROMが内蔵されていて、実行したいプログラムを事前に固定的に書き込んでおく。  
動作中にプログラムを移動したり書き換えたりすることは基本的にない。  
したがって、実行したいプログラムが収まるROM容量の品種を選べばよく、必要以上に大容量のROMを内蔵していても無駄である（諸説あり）。

#### マスクROM
- 不揮発メモリ
- 製造時にメモリ内容をすべて固定化してしまう（後から書き換えられない）
- 量産では最も低コスト
- プログラムの誤消去の危険がない
- 劣化による不良がない

### PROM(Programmable ROM)
- 製造後にユーザが書き込みを行う
- 書き換えができるEPROM(Erasable PROM)と書き換えができないOTP(One Time PROM)にわけられる

#### EEPROM
- 不揮発メモリ
- ROMだけど書き換え可能
- 外付けのデータメモリとして使われる
- Flashと異なり読み出し・書き換えがバイト単位で可能
  - ただし速度はFlash同様遅い
- Flashと異なりあまり大容量にできない
- かつては紫外線で消去するUVEPROMが使われていた

#### Flash Memory
- 不揮発メモリ
- ROMだけど書き換え可能
- NAND型とNOR型がある
  - マイコンの内蔵メモリとして使われているのはNORフラッシュ（以下はこちらについて説明）
- 書き込みは1バイトずつ実行できる
  - 書き込み時間は1バイト当たり数十μs～数百μsくらい
- 消去は1ブロック(数K～数十Kバイト)ずつでしかできない
  - 消去時間は数百ms～数秒くらい
- 基本的に書き込み中や消去中はCPUがホールド状態になる
  - 消去中にイベントが発生するともれなく処理が遅延するので、Flashアクセス中は画面操作を禁止したりする
  - アクチュエータ制御中のアクセスはダメ。ゼッタイ
  - 広範囲のブロックを消去しようとしてウォッチドッグタイマに引っかかるのはよくあること
- 寿命がある
  - 多くても1ブロックあたり10万回の消去
  - 書き込み回数には制限はないため、ブロックの空きがなくなるまでデータを書いてから消去するように処理を工夫するのが重要

### RAM(Random Access Memory)

マイコンはROMとは別にRAMも内蔵している。  
プログラムの実行中にデータを書き込んだり読みだしたりする際に使用するため、データメモリとかワークメモリ（作業用メモリ）と呼ばれることもある。

#### SRAM
- 揮発メモリ
- 速い（確信）
- ビット単価はDRAMより高いが、パソコンよりも扱うデータ量が小さいため許容される
- 電源を備えることで高速な不揮発メモリとして使えるBBM(Battery Backup Memory)もある

### 外付けRAM
携帯情報機器やマルチメディア機器のように大きなデータを扱いたい場合は外付けRAMを使う。

#### DRAM
- 揮発メモリ
- 主に外付け用として用いられる
- 内蔵用として使われないのはチップのサイズ制約とSRAMに比べた遅さによるもの
- SRAMに比べてビット単価が安いため大容量化しやすい
- データメモリとしてだけでなく、プログラムをROMからDRAMに展開して実行する場合もある
  - プログラムアップデートが自力でできるようになる等の利点がある

#### FRAM
- RAMだけど不揮発メモリ
- 主に外付け用として用いられる
- Flashと異なり書き込み前に消去する必要がない
  - バイト単位で読み出し・書き込み可能
- アクセス速度も（ROMよりは）速い

### 余談
https://www.nintendo.co.jp/ds/aphjb24j/oshirase/index.html


### 参考リンク
https://ednjapan.com/edn/articles/1605/25/news022.html
https://ja.na4.teamsupport.com/knowledgeBase/17796070
